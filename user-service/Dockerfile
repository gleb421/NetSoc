# üõ† –°—Ç–∞–¥–∏—è —Å–±–æ—Ä–∫–∏
FROM gradle:8.5-jdk21 AS builder

# –ü–µ—Ä–µ–π–¥—ë–º –≤ –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞
WORKDIR /app

# –ö–æ–ø–∏—Ä—É–µ–º –≤–µ—Å—å –º–æ–Ω–æ—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π (—á—Ç–æ–±—ã –±—ã–ª–∏ settings.gradle –∏ –¥—Ä—É–≥–∏–µ –º–æ–¥—É–ª–∏)
COPY . .

# –°–æ–±–∏—Ä–∞–µ–º —Ç–æ–ª—å–∫–æ user-service
RUN ./gradlew :user-service:bootJar --no-daemon

# üßä –§–∏–Ω–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑
FROM eclipse-temurin:21-jdk-alpine

WORKDIR /app
COPY --from=builder /app/user-service/build/libs/*.jar app.jar

EXPOSE 8081
ENTRYPOINT ["java", "-jar", "app.jar"]
